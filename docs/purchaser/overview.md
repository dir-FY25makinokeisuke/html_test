# Bモジュール - 概要

## 目的

Bモジュールは、商品の購入処理および決済処理を管理するモジュールである。

## 機能一覧

| # | 機能名 | 概要 |
|---|--------|------|
| 1 | カート管理 | 商品のカート追加・削除・数量変更 |
| 2 | 購入確認 | 購入内容の確認画面表示 |
| 3 | 決済処理 | クレジットカード・銀行振込等の決済 |
| 4 | 購入履歴 | 過去の購入履歴の参照 |

## 状態遷移

購入処理は以下の状態で管理される。

```
[カート投入] → [購入確認] → [決済処理中] → [決済完了]
                                  ↓
                            [決済失敗] → [リトライ]
```

| 状態 | コード | 説明 |
|------|--------|------|
| カート投入 | `CART` | 商品がカートに追加された状態 |
| 購入確認 | `CONFIRM` | ユーザーが購入内容を確認中 |
| 決済処理中 | `PROCESSING` | 決済APIを呼び出し中 |
| 決済完了 | `COMPLETED` | 決済が正常に完了 |
| 決済失敗 | `FAILED` | 決済に失敗した状態 |

## データモデル

### 購入情報テーブル (`purchase`)

| カラム名 | 型 | 必須 | 説明 |
|---------|-----|------|------|
| purchase_id | VARCHAR(20) | PK | 購入ID |
| contractor_id | VARCHAR(20) | FK | 契約者ID |
| total_amount | DECIMAL(12,2) | ○ | 合計金額 |
| status | VARCHAR(20) | ○ | ステータス |
| purchased_at | TIMESTAMP | ○ | 購入日時 |
| created_at | TIMESTAMP | ○ | 作成日時 |
| updated_at | TIMESTAMP | ○ | 更新日時 |
