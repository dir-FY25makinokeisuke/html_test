<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è³¼å…¥æ‰‹ç¶šã ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ 
      startOnLoad: true,
      theme: 'default',
      securityLevel: 'loose'
    });
  </script>
  <style>
    :root {
      --bg: #f7f7f8;
      --panel: #ffffff;
      --text: #222;
      --muted: #666;
      --accent: #1363df;
      --border: #e5e7eb;
      --sidebar-w: 280px;
      --primary: #2c3e50;
    }

    /* Reset */
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; padding: 0; }
    body {
      font: 16px/1.7 system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      color: var(--text);
      background: var(--bg);
    }

    /* 2ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .layout {
      display: grid;
      grid-template-columns: var(--sidebar-w) 1fr;
      min-height: 100dvh;
    }

    /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆç« ç«‹ã¦ï¼‰ */
    .sidebar {
      position: sticky;
      top: 0;
      align-self: start;
      height: 100dvh;
      overflow: auto;
      background: var(--panel);
      border-right: 1px solid var(--border);
      padding: 12px 10px;
    }
    .brand {
      font-weight: 700;
      font-size: 18px;
      padding: 12px;
      margin: 0 0 4px;
      color: var(--primary);
    }
    nav[aria-label="ç« ç«‹ã¦"] ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .toc-item {
      margin: 2px 0;
    }
    .toc-link {
      display: flex;
      gap: 8px;
      width: 100%;
      text-align: left;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid transparent;
      background: transparent;
      color: inherit;
      cursor: pointer;
      font-size: 15px;
    }
    .toc-link:hover { background: #f2f4f7; }
    .toc-link[aria-current="true"] {
      background: #eef5ff;
      border-color: #dbeafe;
      color: var(--accent);
      font-weight: 600;
    }

    /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å´ */
    .content {
      padding: 28px min(5vw, 40px);
      overflow-y: auto;
      height: 100dvh;
    }
    .article {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: clamp(16px, 2.5vw, 28px);
      box-shadow: 0 1px 0 rgba(0,0,0,0.03);
      min-height: 60vh;
    }
    .article h1 {
      margin: 0 0 8px;
      line-height: 1.35;
      color: var(--primary);
    }
    .article .meta {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 16px;
    }
    .divider {
      height: 1px;
      background: var(--border);
      margin: 16px 0 24px;
      border: 0;
    }

    /* Markdown ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¹ã‚¿ã‚¤ãƒ« */
    .markdown-body h1 {
      font-size: 28px;
      color: var(--primary);
      border-bottom: 3px solid var(--accent);
      padding-bottom: 12px;
      margin-bottom: 24px;
    }

    .markdown-body h2 {
      font-size: 22px;
      color: var(--primary);
      margin-top: 36px;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }

    .markdown-body h3 {
      font-size: 18px;
      color: var(--primary);
      margin-top: 20px;
      margin-bottom: 12px;
    }

    .markdown-body p {
      line-height: 1.8;
      margin-bottom: 14px;
    }

    .markdown-body ul, .markdown-body ol {
      margin: 12px 0;
      padding-left: 28px;
    }

    .markdown-body li {
      line-height: 1.8;
      margin-bottom: 4px;
    }

    .markdown-body table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 14px;
    }

    .markdown-body thead th {
      background: var(--primary);
      color: #fff;
      padding: 10px 14px;
      text-align: left;
      font-weight: 600;
      font-size: 13px;
    }

    .markdown-body tbody td {
      padding: 10px 14px;
      border-bottom: 1px solid var(--border);
    }

    .markdown-body tbody tr:nth-child(even) {
      background: rgba(0,0,0,0.02);
    }

    .markdown-body tbody tr:hover {
      background: rgba(52, 152, 219, 0.06);
    }

    .markdown-body code {
      background: #e8ecef;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 13px;
      font-family: "Consolas", "Source Code Pro", monospace;
      color: #c0392b;
    }

    .markdown-body pre {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      margin: 20px 0;
      line-height: 1.5;
      font-size: 13px;
    }

    .markdown-body pre code {
      background: none;
      color: inherit;
      padding: 0;
      font-size: 13px;
    }

    .markdown-body hr {
      border: none;
      border-top: 2px solid var(--border);
      margin: 32px 0;
    }

    .markdown-body strong {
      color: var(--primary);
    }

    .markdown-body blockquote {
      border-left: 4px solid var(--accent);
      padding: 12px 20px;
      margin: 16px 0;
      background: rgba(52,152,219,0.05);
      color: var(--muted);
    }

    /* Mermaidå›³ */
    .mermaid {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      margin: 24px 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      border: 1px solid var(--border);
      text-align: center;
    }

    /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--muted);
    }

    .loading::after {
      content: "";
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      vertical-align: middle;
      margin-left: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
    @media (max-width: 860px) {
      .layout {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
      }
      .sidebar {
        height: auto;
        position: static;
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
      .brand { padding: 8px 4px 8px 8px; }
      .toc {
        display: grid;
        grid-template-columns: repeat(2, minmax(0,1fr));
        gap: 6px;
        padding: 8px;
      }
      .toc-link { justify-content: flex-start; }
      .content {
        height: auto;
      }
    }

    /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œç°¡æ˜“è¡¨ç¤ºã€ã‚’å¸Œæœ›ã™ã‚‹å ´åˆ */
    @media (prefers-reduced-motion: reduce) {
      * { scroll-behavior: auto; }
    }

    .visually-hidden {
      position: absolute!important;
      height: 1px; width: 1px;
      overflow: hidden; clip: rect(1px,1px,1px,1px);
      white-space: nowrap; border: 0; padding: 0; margin: -1px;
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- å·¦ï¼šç« ç«‹ã¦ -->
    <aside class="sidebar" role="complementary" aria-label="ç« ç«‹ã¦">
      <h1 class="brand">ğŸ“‹ è³¼å…¥æ‰‹ç¶šã</h1>
      <nav aria-label="ç« ç«‹ã¦">
        <ul class="toc" id="toc">
          <li class="toc-item"><button class="toc-link" data-target="chapter-overview">æ¦‚è¦</button></li>
          <li class="toc-item"><button class="toc-link" data-target="chapter-contractor-seq">å¥‘ç´„è€…æƒ…å ± - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³</button></li>
          <li class="toc-item"><button class="toc-link" data-target="chapter-contractor-api">å¥‘ç´„è€…æƒ…å ± - APIè¨­è¨ˆæ›¸</button></li>
        </ul>
      </nav>
    </aside>

    <!-- å³ï¼šæœ¬æ–‡ -->
    <main class="content" id="main" tabindex="-1">
      <article class="article" aria-live="polite" aria-atomic="true">
        <h1 id="article-title">æ¦‚è¦</h1>
        <p class="meta" id="article-breadcrumb">ç« : 1 / 3</p>
        <hr class="divider" />
        <div id="article-body" class="markdown-body loading">
          èª­ã¿è¾¼ã¿ä¸­...
        </div>
      </article>
    </main>
  </div>

  <script>
    // ç« ãƒ‡ãƒ¼ã‚¿
    const chapters = [
      {
        id: "chapter-overview",
        title: "æ¦‚è¦",
        order: "1 / 3",
        src: "docs/overview.md"
      },
      {
        id: "chapter-contractor-seq",
        title: "å¥‘ç´„è€…æƒ…å ±ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« - ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³",
        order: "2 / 3",
        src: "docs/contractor/sequence.md"
      },
      {
        id: "chapter-contractor-api",
        title: "å¥‘ç´„è€…æƒ…å ±ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« - APIè¨­è¨ˆæ›¸",
        order: "3 / 3",
        src: "docs/contractor/api.md"
      }
    ];

    const $title = document.getElementById('article-title');
    const $breadcrumb = document.getElementById('article-breadcrumb');
    const $body = document.getElementById('article-body');
    const $main = document.getElementById('main');
    const tocButtons = Array.from(document.querySelectorAll('.toc-link'));

    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    const contentCache = {};

    // é¸æŠçŠ¶æ…‹ã®åˆ‡æ›¿
    function updateTocCurrent(targetId){
      tocButtons.forEach(btn => {
        const isCurrent = btn.dataset.target === targetId;
        btn.setAttribute('aria-current', isCurrent ? 'true' : 'false');
      });
    }

    // Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
    async function loadMarkdown(src) {
      if (contentCache[src]) {
        return contentCache[src];
      }

      try {
        const res = await fetch(src);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const md = await res.text();
        const html = marked.parse(md);
        contentCache[src] = html;
        return html;
      } catch (e) {
        console.error(`Failed to load ${src}:`, e);
        return `<p style="color:#e74c3c;">âš  ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: <code>${src}</code></p>`;
      }
    }

    // ç« æç”»
    async function renderChapter(id, pushHash = true){
      const chapter = chapters.find(c => c.id === id) || chapters[0];
      
      $title.textContent = chapter.title;
      $breadcrumb.textContent = `ç« : ${chapter.order}`;
      $body.innerHTML = '<div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>';
      updateTocCurrent(chapter.id);

      // URL ãƒãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
      if (pushHash) history.pushState({ id: chapter.id }, '', `#${chapter.id}`);

      // Markdownã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤º
      const html = await loadMarkdown(chapter.src);
      $body.innerHTML = html;

      // Mermaidå›³ã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
      if (typeof mermaid !== 'undefined') {
        const mermaidElements = $body.querySelectorAll('.mermaid');
        if (mermaidElements.length > 0) {
          mermaid.run({ nodes: mermaidElements });
        }
      }

      // æœ¬æ–‡ã‚³ãƒ³ãƒ†ãƒŠã¸ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ç§»å‹•ï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰
      requestAnimationFrame(() => $main.focus());
    }

    // ã‚¯ãƒªãƒƒã‚¯ã§åˆ‡æ›¿
    tocButtons.forEach(btn => {
      btn.addEventListener('click', () => renderChapter(btn.dataset.target, true));
    });

    // ãƒãƒƒã‚·ãƒ¥é·ç§»ï¼ˆç›´ãƒªãƒ³ã‚¯/æˆ»ã‚‹é€²ã‚€ï¼‰ã«å¯¾å¿œ
    window.addEventListener('popstate', (e) => {
      const id = (e.state && e.state.id) || location.hash.replace('#', '') || chapters[0].id;
      renderChapter(id, false);
    });

    // åˆæœŸè¡¨ç¤ºï¼šãƒãƒƒã‚·ãƒ¥å„ªå…ˆ
    const initialId = location.hash.replace('#', '') || chapters[0].id;
    history.replaceState({ id: initialId }, '', `#${initialId}`);
    renderChapter(initialId, false);
  </script>
</body>
</html>